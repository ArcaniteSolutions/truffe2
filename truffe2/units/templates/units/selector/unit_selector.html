{% load i18n %}

{% with w_title="Contexte" %}{% include "widget/header.html" %}{% endwith %}

{% trans "Tu travailles actuellement avec l'unit√©" %}<br /><br />

<center><b class="cgroupe" pk="{{CURRENT_UNIT.pk}}">{{CURRENT_UNIT.name}}</b></center><br />

<span style="float: right;">
    <div class="dropdown">
    <a class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">{% trans "Changer" %} <span class="caret"></span></a>
    <ul class="dropdown-menu dropdown-menu-right" id="unit-selector">

        {% with c_unit=main_unit %}
            {% include "units/selector/menu_unit.html" %}
        {% endwith %}

    </ul>
    </div>
</span>

<script type="text/javascript">

    function select_unit(pk, name, can_edit) {

        $('.cgroupe').text(name);
        $('.cgroupe').attr("pk", pk);

        {% if function_to_call %}
            {{function_to_call}}(pk, name, can_edit);
        {% endif %}

    }

    // Hide useless menus
    $('#unit-selector .unit-hidden, #unit-selector .sub-title-menu').each(function(__, elem) {
        if ($(elem).parent().find('.unit-displayed').length == 0) {
            $(elem).hide();
        }
    });

    // Hide useless sub-title-menus
    $('#unit-selector .sub-title-menu[style!="display: none;"]').each(function(__, elem) {
        if ($(elem).parent().parent().find('> li > a[style="display: none;"]').length == 2) {
            $(elem).parent().parent().replaceWith($(elem).parent().children('ul'));
        }
    });

    // Hide alone menus (replace the sub ul with the parrent ul)
    $('#unit-selector, #unit-selector ul').each(function (__, elem) {
        if ($(elem).find('> li > .unit-displayed').length == 0 && $(elem).find('> li > .unit-hidden').length == 1) {
            var add_left = $(elem).hasClass('dropdown-menu-right');
            var new_ul = $($(elem).find('> li > .unit-hidden')[0]).parent().children('ul');

            $(new_ul).attr('class', $(elem).attr('class'));

            $(elem).replaceWith(new_ul);
        }
    });

    //Ensure the current unit is selectable
    if ($('#unit-selector-{{CURRENT_UNIT.pk}}').length == 0 || $('#unit-selector-{{CURRENT_UNIT.pk}}').attr('style') == 'display: none;') {
        $('.unit-displayed')[0].click();
    }


</script>

{% include "widget/footer.html" %}
